<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-touch-fullscreen" content="yes">
  <meta name="format-detection" content="telephone=no">
  <title>Pickleball Swipe Scorer</title>
  <style>
    :root {
      /* 精心調配的色彩方案 */
      --bg: linear-gradient(135deg, #0a0a1a 0%, #1a1a2e 50%, #16213e 100%);
      --bg-solid: #0a0a1a;
      --panel: rgba(255, 255, 255, 0.08);
      --panel-border: rgba(255, 255, 255, 0.12);
      --blue: #00d4ff;
      --blue-glow: rgba(0, 212, 255, 0.4);
      --red: #ff3366;
      --red-glow: rgba(255, 51, 102, 0.4);
      --white: #ffffff;
      --green: #00ff88;
      --green-glow: rgba(0, 255, 136, 0.4);
      --muted: #8b949e;
      --divider: rgba(255, 255, 255, 0.18);
      --shadow: rgba(0, 0, 0, 0.4);
      --text-primary: #ffffff;
      --text-secondary: #b1b7c1;
      --touch-feedback: rgba(255, 255, 255, 0.15);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: var(--bg-solid);
      background-image: var(--bg);
      color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      overflow: hidden;
      position: fixed;
      width: 100%;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .app {
      height: 100vh;
      height: 100dvh; /* 動態視窗高度 */
      display: flex;
      flex-direction: column;
      position: relative;
      touch-action: none;
    }

    /* 頂部區域 - 優化觸控 */
    .top {
      padding: max(env(safe-area-inset-top), 24px) 24px 20px;
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(24px);
      border-bottom: 1px solid var(--panel-border);
      min-height: 80px;
    }

    .names {
      display: grid;
      grid-template-columns: 1fr 1fr;
      align-items: center;
      gap: 20px;
      font-weight: 600;
      font-size: 17px;
    }

    .names .cell {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 12px 16px;
      border-radius: 16px;
      transition: all 0.2s ease;
      min-height: 48px; /* 確保觸控區域足夠大 */
      cursor: pointer;
    }

    .names .cell:active {
      background: var(--touch-feedback);
      transform: scale(0.96);
    }

    .dot {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: var(--muted);
      border: 2px solid transparent;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      flex-shrink: 0;
    }

    .dot.active {
      background: var(--green);
      box-shadow: 
        0 0 20px var(--green-glow), 
        0 0 40px var(--green-glow),
        0 2px 8px rgba(0, 255, 136, 0.3);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { 
        transform: scale(1); 
        opacity: 1;
      }
      50% { 
        transform: scale(1.15); 
        opacity: 0.9;
      }
    }

    .divider {
      height: 3px;
      background: linear-gradient(90deg, transparent, var(--divider), transparent);
      margin: 20px 0;
      border-radius: 2px;
    }

    /* 主要計分區域 - 優化觸控體驗 */
    .board {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      padding: 24px;
      min-height: 0;
    }

    .scores {
      display: flex;
      align-items: center;
      gap: min(6vw, 32px);
      z-index: 2;
      position: relative;
    }

    .big {
      font-size: min(16vw, 140px);
      line-height: 0.9;
      font-weight: 900;
      letter-spacing: -3px;
      text-shadow: 0 4px 24px var(--shadow);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    .big.blue {
      color: var(--blue);
      text-shadow: 
        0 0 40px var(--blue-glow), 
        0 4px 24px var(--shadow),
        0 0 80px rgba(0, 212, 255, 0.2);
    }

    .big.red {
      color: var(--red);
      text-shadow: 
        0 0 40px var(--red-glow), 
        0 4px 24px var(--shadow),
        0 0 80px rgba(255, 51, 102, 0.2);
    }

    .big.white {
      color: var(--white);
      font-size: min(13vw, 110px);
      opacity: 0.95;
      text-shadow: 0 4px 20px var(--shadow);
    }

    .dotSep {
      font-size: min(8vw, 64px);
      opacity: 0.35;
      color: var(--muted);
      font-weight: 300;
    }

    /* 滑動區域 - 大幅優化觸控 */
    .pad {
      position: absolute;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      color: var(--text-secondary);
      user-select: none;
      z-index: 1;
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .pad.top {
      top: 0;
      height: 40%; /* 增加觸控區域 */
      background: linear-gradient(180deg, rgba(255, 51, 102, 0.06) 0%, transparent 70%);
    }

    .pad.bottom {
      bottom: 0;
      height: 40%; /* 增加觸控區域 */
      background: linear-gradient(0deg, rgba(0, 212, 255, 0.06) 0%, transparent 70%);
    }

    .pad:active {
      background-color: var(--touch-feedback);
    }

    .pad.top:active {
      background: linear-gradient(180deg, rgba(255, 51, 102, 0.15) 0%, var(--touch-feedback) 70%);
    }

    .pad.bottom:active {
      background: linear-gradient(0deg, rgba(0, 212, 255, 0.15) 0%, var(--touch-feedback) 70%);
    }

    .chev {
      width: 0;
      height: 0;
      border-left: 18px solid transparent;
      border-right: 18px solid transparent;
      opacity: 0.8;
      filter: drop-shadow(0 4px 20px rgba(0, 0, 0, 0.5));
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .chev.red {
      border-bottom: 24px solid var(--red);
    }

    .chev.blue {
      border-top: 24px solid var(--blue);
    }

    .pad:active .chev {
      opacity: 1;
      transform: scale(1.3);
    }

    .pad.top:active .chev.red {
      filter: drop-shadow(0 0 20px var(--red-glow));
    }

    .pad.bottom:active .chev.blue {
      filter: drop-shadow(0 0 20px var(--blue-glow));
    }

    /* 重置按鈕 - 優化觸控 */
    .reset-btn {
      position: absolute;
      background: var(--panel);
      backdrop-filter: blur(24px);
      border: 1px solid var(--panel-border);
      color: var(--text-primary);
      padding: 14px 24px;
      border-radius: 24px;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 24px var(--shadow);
      z-index: 3;
      min-height: 48px; /* 確保觸控區域 */
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .reset-btn:hover {
      background: rgba(255, 255, 255, 0.12);
      transform: translateY(-2px);
      box-shadow: 0 6px 30px var(--shadow);
    }

    .reset-btn:active {
      transform: translateY(0) scale(0.96);
      background: rgba(255, 255, 255, 0.18);
    }

    /* 提示文字 - 優化顯示 */
    .hint {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 24px;
      font-size: 13px;
      color: var(--text-secondary);
      opacity: 0.9;
      text-align: center;
      padding: 10px 20px;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 20px;
      backdrop-filter: blur(12px);
      z-index: 3;
      max-width: 90%;
      line-height: 1.4;
    }

    /* 底部區域 - 優化觸控 */
    .bottom {
      padding: 20px 24px max(env(safe-area-inset-bottom), 24px);
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(24px);
      border-top: 1px solid var(--panel-border);
      min-height: 80px;
    }

    .mini {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      gap: 20px;
      width: 100%;
    }

    .mini .cell {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 12px 16px;
      border-radius: 16px;
      transition: all 0.2s ease;
      min-height: 48px; /* 確保觸控區域 */
      cursor: pointer;
    }

    .mini .cell:active {
      background: var(--touch-feedback);
      transform: scale(0.96);
    }

    .mini .name {
      font-weight: 600;
      font-size: 17px;
    }

    .tap {
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 700;
    }

    .tap:active {
      transform: scale(0.95);
    }

    /* iPhone尺寸適配 */
    
    /* iPhone SE/Mini (375px) */
    @media screen and (max-width: 375px) {
      .big {
        font-size: min(18vw, 110px);
      }
      
      .big.white {
        font-size: min(15vw, 88px);
      }
      
      .dotSep {
        font-size: min(10vw, 50px);
      }
      
      .scores {
        gap: min(4vw, 20px);
      }
      
      .hint {
        font-size: 12px;
        bottom: 20px;
      }
      
      .top, .bottom {
        padding-left: 20px;
        padding-right: 20px;
      }
    }

    /* iPhone 標準 (390px-414px) */
    @media screen and (min-width: 376px) and (max-width: 414px) {
      .big {
        font-size: min(16vw, 120px);
      }
      
      .big.white {
        font-size: min(13vw, 96px);
      }
    }

    /* iPhone Pro Max (428px+) */
    @media screen and (min-width: 428px) {
      .big {
        font-size: 150px;
      }
      
      .big.white {
        font-size: 120px;
      }
      
      .dotSep {
        font-size: 70px;
      }
      
      .scores {
        gap: 36px;
      }
    }

    /* 橫屏適配 */
    @media screen and (orientation: landscape) and (max-height: 500px) {
      .top, .bottom {
        padding-top: 16px;
        padding-bottom: 16px;
        min-height: 60px;
      }
      
      .big {
        font-size: min(14vh, 100px);
      }
      
      .big.white {
        font-size: min(11vh, 80px);
      }
      
      .dotSep {
        font-size: min(8vh, 50px);
      }
      
      .pad.top, .pad.bottom {
        height: 35%;
      }
      
      .hint {
        bottom: 16px;
        font-size: 12px;
      }
      
      .board {
        padding: 16px;
      }
    }

    /* 超寬屏適配 */
    @media screen and (orientation: landscape) and (min-width: 800px) {
      .app {
        max-width: 600px;
        margin: 0 auto;
        border-left: 1px solid var(--panel-border);
        border-right: 1px solid var(--panel-border);
      }
    }

    /* 動畫效果 */
    .score-animation {
      animation: scoreUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes scoreUp {
      0% { transform: scale(1); }
      50% { transform: scale(1.15); }
      100% { transform: scale(1); }
    }

    .reset-animation {
      animation: resetPulse 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes resetPulse {
      0% { transform: scale(1) translateX(-50%); }
      25% { transform: scale(0.9) translateX(-50%); }
      50% { transform: scale(1.05) translateX(-50%); }
      100% { transform: scale(1) translateX(-50%); }
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <div class="top">
      <div class="names">
        <div class="cell">
          <span class="dot" id="dotA1"></span>
          <span class="tap" id="nameA1">Awais</span>
        </div>
        <div class="cell" style="justify-content: flex-end">
          <span class="tap" id="nameA2">Haris</span>
          <span class="dot" id="dotA2"></span>
        </div>
      </div>
      <div class="divider"></div>
    </div>

    <div class="board" id="board">
      <div class="pad top" id="padTop">
        <div class="chev red"></div>
      </div>

      <div class="scores">
        <div class="big blue" id="scoreA">0</div>
        <div class="dotSep">·</div>
        <div class="big red" id="scoreB">0</div>
        <div class="dotSep">·</div>
        <div class="big white" id="serverNum">2</div>
      </div>

      <button class="reset-btn" id="reset">重置</button>

      <div class="pad bottom" id="padBottom">
        <div class="chev blue"></div>
      </div>
      
      <div class="hint">上滑紅箭頭：B隊得分或交球 ｜ 下滑藍箭頭：A隊得分或交球</div>
    </div>

    <div class="bottom">
      <div class="mini">
        <div class="cell">
          <span class="dot" id="dotB1"></span>
          <span class="tap" id="nameB1">Jov</span>
        </div>
        <div style="height: 3px; background: linear-gradient(90deg, transparent, var(--divider), transparent); border-radius: 2px; margin: 0 auto; width: 50px;"></div>
        <div class="cell" style="justify-content: flex-end">
          <span class="tap" id="nameB2">Sana</span>
          <span class="dot active" id="dotB2"></span>
        </div>
      </div>
    </div>
  </div>

  <script>
    const state = {
      A: 0,
      B: 0,
      servingTeam: 'B',
      serverNumber: 2,
      serverSpot: 'B2',
    };

    const el = id => document.getElementById(id);
    const scoreA = el('scoreA');
    const scoreB = el('scoreB'); 
    const serveNum = el('serverNum');
    const boardEl = el('board');
    const resetBtn = el('reset');
    const dots = {
      A1: el('dotA1'),
      A2: el('dotA2'), 
      B1: el('dotB1'),
      B2: el('dotB2')
    };
    const names = {
      A1: el('nameA1'),
      A2: el('nameA2'),
      B1: el('nameB1'), 
      B2: el('nameB2')
    };

    function render() {
      scoreA.textContent = state.A;
      scoreB.textContent = state.B;
      serveNum.textContent = state.serverNumber;
      
      // 清除所有active狀態
      for (const k in dots) {
        dots[k].classList.remove('active');
      }
      
      // 設置當前發球者
      if (dots[state.serverSpot]) {
        dots[state.serverSpot].classList.add('active');
      }
      
      placeResetBtn();
    }

    function pointTo(team) {
      if (team === 'A') {
        state.A++;
        // 添加動畫效果
        scoreA.classList.add('score-animation');
        setTimeout(() => scoreA.classList.remove('score-animation'), 400);
      } else {
        state.B++;
        // 添加動畫效果
        scoreB.classList.add('score-animation');
        setTimeout(() => scoreB.classList.remove('score-animation'), 400);
      }
      render();
    }

    function loseRally() {
      if (state.servingTeam === 'B') {
        if (state.serverNumber === 1) {
          state.serverNumber = 2;
          state.serverSpot = 'B2';
        } else {
          state.servingTeam = 'A';
          state.serverNumber = 1;
          state.serverSpot = 'A1';
        }
      } else {
        if (state.serverNumber === 1) {
          state.serverNumber = 2;
          state.serverSpot = 'A2';
        } else {
          state.servingTeam = 'B';
          state.serverNumber = 1;
          state.serverSpot = 'B1';
        }
      }
      
      // 發球者變更動畫
      serveNum.classList.add('score-animation');
      setTimeout(() => serveNum.classList.remove('score-animation'), 400);
      
      render();
    }

    function reset() {
      state.A = 0;
      state.B = 0;
      state.servingTeam = 'B';
      state.serverNumber = 2;
      state.serverSpot = 'B2';
      render();
      
      // 重置動畫
      resetBtn.classList.add('reset-animation');
      setTimeout(() => resetBtn.classList.remove('reset-animation'), 600);
      
      [scoreA, scoreB, serveNum].forEach((el, index) => {
        setTimeout(() => {
          el.classList.add('score-animation');
          setTimeout(() => el.classList.remove('score-animation'), 400);
        }, index * 100);
      });
    }

    function attachSwipe(el, direction, cb) {
      let startY = null;
      let startTime = null;
      let active = false;
      const threshold = 40; // 優化的滑動閾值
      const maxTime = 1000; // 最大滑動時間
      
      // 觸控事件
      el.addEventListener('touchstart', e => {
        e.preventDefault();
        startY = e.touches[0].clientY;
        startTime = Date.now();
        active = true;
      }, { passive: false });
      
      el.addEventListener('touchmove', e => {
        if (!active) return;
        e.preventDefault();
        
        const currentY = e.touches[0].clientY;
        const deltaY = currentY - startY;
        const deltaTime = Date.now() - startTime;
        
        // 檢查滑動方向和距離
        if (deltaTime < maxTime) {
          if (direction === 'up' && deltaY < -threshold) {
            active = false;
            triggerHapticFeedback();
            cb();
          } else if (direction === 'down' && deltaY > threshold) {
            active = false;
            triggerHapticFeedback();
            cb();
          }
        }
      }, { passive: false });
      
      el.addEventListener('touchend', () => {
        active = false;
      });
      
      el.addEventListener('touchcancel', () => {
        active = false;
      });
      
      // 滑鼠事件（桌面測試用）
      el.addEventListener('mousedown', e => {
        startY = e.clientY;
        startTime = Date.now();
        active = true;
      });
      
      window.addEventListener('mousemove', e => {
        if (!active) return;
        
        const deltaY = e.clientY - startY;
        const deltaTime = Date.now() - startTime;
        
        if (deltaTime < maxTime) {
          if (direction === 'up' && deltaY < -threshold) {
            active = false;
            cb();
          } else if (direction === 'down' && deltaY > threshold) {
            active = false;
            cb();
          }
        }
      });
      
      window.addEventListener('mouseup', () => {
        active = false;
      });
    }

    function triggerHapticFeedback() {
      // 觸覺反饋
      if (navigator.vibrate) {
        navigator.vibrate(30); // 短促的震動
      }
    }

    // 設置滑動手勢
    attachSwipe(el('padTop'), 'up', () => {
      if (state.servingTeam === 'B') {
        loseRally();
      } else {
        pointTo('B');
      }
    });

    attachSwipe(el('padBottom'), 'down', () => {
      if (state.servingTeam === 'A') {
        loseRally();
      } else {
        pointTo('A');
      }
    });

    // 重置按鈕事件
    resetBtn.addEventListener('click', e => {
      e.preventDefault();
      triggerHapticFeedback();
      reset();
    });

    // 名字點擊編輯
    for (const key in names) {
      names[key].addEventListener('click', e => {
        e.preventDefault();
        const current = names[key].textContent.trim();
        const newName = prompt('修改選手名稱：', current);
        if (newName !== null && newName.trim() !== '') {
          names[key].textContent = newName.trim();
        }
      });
    }

    function placeResetBtn() {
      const scoreRect = scoreB.getBoundingClientRect();
      const boardRect = boardEl.getBoundingClientRect();
      
      resetBtn.style.left = (scoreRect.left + scoreRect.width / 2 - boardRect.left) + 'px';
      resetBtn.style.top = (scoreRect.bottom - boardRect.top + 24) + 'px';
      resetBtn.style.transform = 'translateX(-50%)';
    }

    // 監聽窗口變化
    window.addEventListener('resize', () => {
      setTimeout(placeResetBtn, 50);
    });
    
    window.addEventListener('orientationchange', () => {
      setTimeout(placeResetBtn, 200);
    });

    // 防止頁面滾動和縮放
    document.addEventListener('touchmove', e => {
      e.preventDefault();
    }, { passive: false });

    document.addEventListener('gesturestart', e => {
      e.preventDefault();
    });

    document.addEventListener('gesturechange', e => {
      e.preventDefault();
    });

    document.addEventListener('gestureend', e => {
      e.preventDefault();
    });

    // 防止雙擊縮放
    let lastTouchEnd = 0;
    document.addEventListener('touchend', e => {
      const now = (new Date()).getTime();
      if (now - lastTouchEnd <= 300) {
        e.preventDefault();
      }
      lastTouchEnd = now;
    }, false);

    // 初始化
    render();
    
    // 頁面加載完成後調整按鈕位置
    window.addEventListener('load', () => {
      setTimeout(placeResetBtn, 100);
    });
  </script>
</body>
</html>

